@page "/dashboard"

<PageTitle>Comunidad Docente - FIME</PageTitle>

<div class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50">
    <div class="max-w-7xl mx-auto p-6">
        <!-- Hero Header -->
        <div class="text-center mb-12">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-blue-600 to-blue-700 rounded-2xl mb-6 shadow-lg">
                <i class="bi bi-mortarboard-fill text-white text-3xl"></i>
            </div>
            <h1 class="text-5xl font-bold text-gray-800 mb-4">Comunidad Docente FIME</h1>
            <p class="text-gray-600 text-xl max-w-2xl mx-auto leading-relaxed">
                Conecta con profesores, explora materias y participa en la comunidad académica más vibrante
            </p>
        </div>
        
        <!-- Stats Section -->
        <StatsSection ProfesoresCount="profesoresCount" 
                     MateriasCount="materiasCount" 
                     ComentariosCount="comentariosCount" 
                     EvaluacionesCount="evaluacionesCount" />
        
        <!-- Profesores Section -->
        <ProfesoresSection Profesores="profesores" 
                          MostrarTodos="mostrarTodosProfesores"
                          OnProfesorSelected="SeleccionarProfesor"
                          OnToggleProfesores="ToggleProfesores" />
        
        <!-- Materias Section -->
        <MateriasSection MateriasFiltradas="materiasFiltradas" 
                        OnFiltroChanged="FiltrarMaterias" />
        
        <!-- Comentarios Section -->
        <ComentariosSection Comentarios="comentarios"
                           MostrarFormulario="mostrarFormComentario"
                           NuevoComentario="nuevoComentario"
                           OnMostrarFormulario="MostrarFormularioComentario"
                           OnCancelar="CancelarComentario"
                           OnPublicar="PublicarComentario"
                           OnToggleLike="ToggleLike"
                           OnResponder="ResponderComentario" />
    </div>
</div>



@code {
    // Estadísticas
    private int profesoresCount = 0;
    private int materiasCount = 0;
    private int comentariosCount = 0;
    private int evaluacionesCount = 0;

    // Profesores
    private List<Profesor> profesores = new();
    private bool mostrarTodosProfesores = false;

    // Materias
    private List<Materia> materias = new();
    private List<Materia> materiasFiltradas = new();

    // Comentarios
    private List<Comentario> comentarios = new();
    private bool mostrarFormComentario = false;
    private string nuevoComentario = "";

    protected override async Task OnInitializedAsync()
    {
        await CargarDatosComunidad();
    }

    private async Task CargarDatosComunidad()
    {
        await Task.Delay(500); // Simular carga

        var random = new Random();
        
        // Estadísticas
        profesoresCount = random.Next(45, 85);
        materiasCount = random.Next(120, 180);
        comentariosCount = random.Next(25, 60);
        evaluacionesCount = random.Next(200, 400);

        // Cargar profesores
        profesores = new List<Profesor>
        {
            new Profesor { Id = 1, Nombre = "Dr. Ana García", Titulo = "Doctora en Ingeniería Civil", Avatar = "https://images.unsplash.com/photo-1494790108755-2616c96d5e55?w=80&h=80&fit=crop&crop=face", EnLinea = true, Rating = 5, NumeroEvaluaciones = 45, Materias = new List<string> { "Estructuras", "Concreto", "Diseño Sísmico" } },
            new Profesor { Id = 2, Nombre = "Ing. Carlos Mendoza", Titulo = "Maestro en Ingeniería Mecánica", Avatar = "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=80&h=80&fit=crop&crop=face", EnLinea = false, Rating = 4, NumeroEvaluaciones = 32, Materias = new List<string> { "Termodinámica", "Mecánica de Fluidos" } },
            new Profesor { Id = 3, Nombre = "Dra. Laura Rodríguez", Titulo = "Doctora en Ingeniería Industrial", Avatar = "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=80&h=80&fit=crop&crop=face", EnLinea = true, Rating = 5, NumeroEvaluaciones = 67, Materias = new List<string> { "Investigación de Operaciones", "Control de Calidad", "Lean Manufacturing" } },
            new Profesor { Id = 4, Nombre = "Ing. Roberto Silva", Titulo = "Maestro en Ingeniería Eléctrica", Avatar = "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=80&h=80&fit=crop&crop=face", EnLinea = true, Rating = 4, NumeroEvaluaciones = 28, Materias = new List<string> { "Circuitos", "Electrónica", "Control Automático" } },
            new Profesor { Id = 5, Nombre = "Dr. Patricia López", Titulo = "Doctora en Matemáticas Aplicadas", Avatar = "https://images.unsplash.com/photo-1580489944761-15a19d654956?w=80&h=80&fit=crop&crop=face", EnLinea = false, Rating = 5, NumeroEvaluaciones = 89, Materias = new List<string> { "Cálculo Diferencial", "Álgebra Lineal", "Ecuaciones Diferenciales" } },
            new Profesor { Id = 6, Nombre = "Ing. Miguel Torres", Titulo = "Maestro en Ingeniería Civil", Avatar = "https://images.unsplash.com/photo-1560250097-0b93528c311a?w=80&h=80&fit=crop&crop=face", EnLinea = true, Rating = 4, NumeroEvaluaciones = 41, Materias = new List<string> { "Hidráulica", "Geotecnia" } },
            new Profesor { Id = 7, Nombre = "Dra. Carmen Jiménez", Titulo = "Doctora en Ingeniería Química", Avatar = "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=80&h=80&fit=crop&crop=face", EnLinea = false, Rating = 5, NumeroEvaluaciones = 53, Materias = new List<string> { "Química Orgánica", "Procesos Industriales", "Catálisis" } },
            new Profesor { Id = 8, Nombre = "Ing. Fernando Vega", Titulo = "Maestro en Sistemas Computacionales", Avatar = "https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?w=80&h=80&fit=crop&crop=face", EnLinea = true, Rating = 4, NumeroEvaluaciones = 36, Materias = new List<string> { "Programación", "Base de Datos", "Redes" } }
        };

        // Cargar materias
        materias = new List<Materia>
        {
            new Materia { Id = 1, Nombre = "Análisis Estructural", Codigo = "IC-301", Carrera = "Ingeniería Civil", Profesores = new List<string> { "Dr. Ana García", "Ing. Miguel Torres" }, NumeroEstudiantes = 45, Rating = 4.5m },
            new Materia { Id = 2, Nombre = "Termodinámica I", Codigo = "IM-201", Carrera = "Ingeniería Mecánica", Profesores = new List<string> { "Ing. Carlos Mendoza" }, NumeroEstudiantes = 38, Rating = 4.2m },
            new Materia { Id = 3, Nombre = "Investigación de Operaciones", Codigo = "II-401", Carrera = "Ingeniería Industrial", Profesores = new List<string> { "Dra. Laura Rodríguez" }, NumeroEstudiantes = 52, Rating = 4.8m },
            new Materia { Id = 4, Nombre = "Circuitos Eléctricos", Codigo = "IE-101", Carrera = "Ingeniería Eléctrica", Profesores = new List<string> { "Ing. Roberto Silva" }, NumeroEstudiantes = 41, Rating = 4.3m },
            new Materia { Id = 5, Nombre = "Cálculo Diferencial", Codigo = "MT-101", Carrera = "Ingeniería Civil", Profesores = new List<string> { "Dr. Patricia López" }, NumeroEstudiantes = 67, Rating = 4.6m },
            new Materia { Id = 6, Nombre = "Mecánica de Fluidos", Codigo = "IM-301", Carrera = "Ingeniería Mecánica", Profesores = new List<string> { "Ing. Carlos Mendoza" }, NumeroEstudiantes = 33, Rating = 4.1m }
        };

        materiasFiltradas = materias;

        // Cargar comentarios
        comentarios = new List<Comentario>
        {
            new Comentario { Id = 1, Autor = "Dr. Ana García", Avatar = "https://images.unsplash.com/photo-1494790108755-2616c96d5e55?w=48&h=48&fit=crop&crop=face", Contenido = "¡Bienvenidos al nuevo semestre! Espero que tengamos un excelente período académico lleno de aprendizaje y colaboración.", Fecha = DateTime.Now.AddHours(-2), Likes = 12, MeGusta = false },
            new Comentario { Id = 2, Autor = "Ing. Carlos Mendoza", Avatar = "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=48&h=48&fit=crop&crop=face", Contenido = "¿Alguien ha trabajado con el nuevo software de simulación térmica? Me gustaría intercambiar experiencias.", Fecha = DateTime.Now.AddHours(-5), Likes = 8, MeGusta = true },
            new Comentario { Id = 3, Autor = "Dra. Laura Rodríguez", Avatar = "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=48&h=48&fit=crop&crop=face", Contenido = "Compartiendo algunos recursos útiles para la optimización de procesos industriales. Los subiré al repositorio común.", Fecha = DateTime.Now.AddDays(-1), Likes = 15, MeGusta = false },
            new Comentario { Id = 4, Autor = "Ing. Roberto Silva", Avatar = "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=48&h=48&fit=crop&crop=face", Contenido = "Recordatorio: La conferencia sobre energías renovables es mañana a las 10:00 AM en el auditorio principal.", Fecha = DateTime.Now.AddDays(-2), Likes = 6, MeGusta = false }
        };
    }

    private void ToggleProfesores()
    {
        mostrarTodosProfesores = !mostrarTodosProfesores;
    }

    private void SeleccionarProfesor(Profesor profesor)
    {
        // Aquí podrías navegar a la página del profesor o mostrar más detalles
        Console.WriteLine($"Profesor seleccionado: {profesor.Nombre}");
    }

    private void FiltrarMaterias(ChangeEventArgs e)
    {
        var filtro = e.Value?.ToString();
        if (string.IsNullOrEmpty(filtro))
        {
            materiasFiltradas = materias;
        }
        else
        {
            materiasFiltradas = materias.Where(m => m.Carrera == filtro).ToList();
        }
    }

    private void MostrarFormularioComentario()
    {
        mostrarFormComentario = true;
        nuevoComentario = "";
    }

    private void CancelarComentario()
    {
        mostrarFormComentario = false;
        nuevoComentario = "";
    }

    private async Task PublicarComentario()
    {
        if (!string.IsNullOrWhiteSpace(nuevoComentario))
        {
            var comentario = new Comentario
            {
                Id = comentarios.Count + 1,
                Autor = "Usuario Actual", // En una app real, obtener del contexto de usuario
                Avatar = "https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=48&h=48&fit=crop&crop=face",
                Contenido = nuevoComentario,
                Fecha = DateTime.Now,
                Likes = 0,
                MeGusta = false
            };

            comentarios.Insert(0, comentario);
            mostrarFormComentario = false;
            nuevoComentario = "";
            
            await Task.Delay(100); // Simular guardado
            StateHasChanged();
        }
    }

    private void ToggleLike(Comentario comentario)
    {
        comentario.MeGusta = !comentario.MeGusta;
        comentario.Likes += comentario.MeGusta ? 1 : -1;
    }

    private void ResponderComentario(Comentario comentario)
    {
        // Implementar lógica de respuesta
        Console.WriteLine($"Responder a: {comentario.Autor}");
    }


}